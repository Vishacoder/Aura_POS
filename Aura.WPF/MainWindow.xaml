<Window x:Class="Aura.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:v="clr-namespace:Aura.Core.ViewModels;assembly=Aura.Core"
        
        Title="Aura POS System" Height="768" Width="1024">

    <Window.Resources>
        <DataTemplate DataType="{x:Type v:TransactionViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="5*" />
                    <ColumnDefinition Width="2*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="#EFEFEF" BorderBrush="#CCC" BorderThickness="0,0,1,0">
                    <TextBlock Text="PRODUCT BROWSER / INVENTORY" HorizontalAlignment="Center" VerticalAlignment="Center" TextWrapping="Wrap" Margin="10"/>
                </Border>

                <StackPanel Grid.Column="1" Margin="10">
                    <TextBlock Text="Sale Cart" FontSize="20" FontWeight="Bold"/>

                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" 
                                 KeyDown="TextBox_KeyDown" 
                                 Tag="Scan/Search SKU or Name" />
                        <Button Grid.Column="1" Command="{Binding AddProductCommand}" Content="Add" Margin="5,0,0,0"/>
                    </Grid>

                    <DataGrid ItemsSource="{Binding CartItems}" AutoGenerateColumns="False" 
                              IsReadOnly="True" Height="400" Margin="0,10">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Product" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Price" Binding="{Binding Price, StringFormat={}{0:C}}" Width="80"/>
                            <DataGridTextColumn Header="Qty" Binding="{Binding Quantity}" Width="50"/>
                            <DataGridTextColumn Header="Subtotal" Binding="{Binding Subtotal, StringFormat={}{0:C}}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Button Content="Remove Selected Item" Command="{Binding RemoveItemCommand}" Margin="0,5"/>
                </StackPanel>

                <Border Grid.Column="2" Background="#F0F0F0" Padding="15">
                    <StackPanel>
                        <TextBlock Text="CHECKOUT" FontSize="20" FontWeight="Bold" Margin="0,0,0,10"/>

                        <TextBlock Text="SUBTOTAL:" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding SubtotalDisplay, StringFormat={}{0:C}}" FontSize="24" Margin="0,0,0,10"/>

                        <TextBlock Text="GRAND TOTAL:" FontWeight="Bold"/>
                        <TextBlock Text="{Binding GrandTotalDisplay, StringFormat={}{0:C}}" FontSize="32" Foreground="DarkGreen" Margin="0,0,0,20"/>

                        <TextBlock Text="CASH TENDERED:" FontWeight="SemiBold"/>
                        <TextBox Text="{Binding TenderedAmount, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" FontSize="24" Margin="0,5,0,10"/>

                        <TextBlock Text="CHANGE DUE:" FontWeight="Bold"/>
                        <TextBlock Text="{Binding ChangeDueDisplay, StringFormat={}{0:C}}" FontSize="32" Foreground="DarkRed" Margin="0,0,0,20"/>

                        <Button Content="PROCESS SALE (F1)" Command="{Binding ProcessSaleCommand}" Height="50" FontSize="18" Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type v:ProductManagementViewModel}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>

                <DataGrid Grid.Column="0" Margin="10" 
                  ItemsSource="{Binding Products}" 
                  SelectedItem="{Binding SelectedProduct}"
                  AutoGenerateColumns="False" 
                  IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                        <DataGridTextColumn Header="SKU" Binding="{Binding SKU}" Width="100"/>
                        <DataGridTextColumn Header="Price" Binding="{Binding Price, StringFormat={}{0:C}}" Width="80"/>
                        <DataGridTextColumn Header="Stock" Binding="{Binding StockQuantity}" Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>

                <StackPanel Grid.Column="1" Margin="10">
                    <TextBlock Text="{Binding CurrentProduct.Id, StringFormat='Product ID: {0}'}" FontWeight="Bold" Margin="0,0,0,10"/>

                    <TextBlock Text="Name"/>
                    <TextBox Text="{Binding CurrentProduct.Name, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,5"/>

                    <TextBlock Text="SKU (Barcode)"/>
                    <TextBox Text="{Binding CurrentProduct.SKU, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,5"/>

                    <TextBlock Text="Price"/>
                    <TextBox Text="{Binding CurrentProduct.Price, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" Margin="0,0,0,5"/>

                    <TextBlock Text="Stock Quantity"/>
                    <TextBox Text="{Binding CurrentProduct.StockQuantity, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,15"/>

                    <Button Content="Save Product" Command="{Binding SaveProductCommand}" Margin="0,10" Height="30"/>
                    <Button Content="Delete Selected" Command="{Binding DeleteProductCommand}" Margin="0,5" Height="30" 
                    IsEnabled="{Binding SelectedProduct, Converter={StaticResource IsNotNullConverter}}"/>
                    <Button Content="New/Clear Form" Command="{Binding NewProductCommand}" Margin="0,15,0,0" Height="30"/>

                </StackPanel>
            </Grid>
        </DataTemplate>

    </Window.Resources>

    <Grid>
        <ContentControl Content="{Binding CurrentViewModel}" />
    </Grid>
</Window>